<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="BA Bingo: bingo game for business analysts and dev teams">
    <meta name="keywords" content="business analyst, bingo, game, IT, development, requirements, BA, lofi, agile, scrum">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="BA Bingo: Lofi Edition">
    <meta property="og:description" content="BA Bingo: bingo game for business analysts and dev teams">
    <meta property="og:image" content="https://raw.githubusercontent.com/StepSaz/ba-bingo-lofi/main/preview.png">

    <title>BA Bingo: Lofi Edition</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Lofi "Cozy Midnight Study Session" Palette */
            --bg-color: #1e1c2a;
            --bg-secondary: #2a2738;

            /* Retro Accents */
            --sunset-pink: #f472b6;
            --warm-yellow: #fbbf24;
            --retro-teal: #2dd4bf;
            --purple-glow: #a78bfa;

            /* Card styling */
            --card-bg: rgba(255, 255, 255, 0.04);
            --card-border: rgba(255, 255, 255, 0.1);
            --card-hover: rgba(244, 114, 182, 0.15);
            --card-selected: rgba(251, 191, 36, 0.25);

            /* Typography */
            --text-color: #e5e5e5;
            --text-secondary: rgba(229, 229, 229, 0.7);

            /* Win state */
            --win-color: #2dd4bf;
            --win-glow: rgba(45, 212, 191, 0.6);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Quicksand', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 10px;
            -webkit-font-smoothing: antialiased;
            position: relative;
            overflow-x: hidden;
        }

        /* Grain/Noise Texture Overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 1;
            opacity: 0.4;
        }

        /* CRT Scanlines Effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1;
            opacity: 0.3;
        }

        /* Floating Ambient Blobs */
        .ambient-glow {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .ambient-glow::before,
        .ambient-glow::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.15;
            animation: floatSlow 30s ease-in-out infinite;
        }

        .ambient-glow::before {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, var(--sunset-pink) 0%, transparent 70%);
            top: -250px;
            right: 10%;
            animation-delay: 0s;
        }

        .ambient-glow::after {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, var(--retro-teal) 0%, transparent 70%);
            bottom: -200px;
            left: 10%;
            animation-delay: -15s;
        }

        @keyframes floatSlow {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -40px) scale(1.1); }
            50% { transform: translate(-20px, 30px) scale(0.9); }
            75% { transform: translate(25px, 50px) scale(1.05); }
        }

        /* Content with z-index above effects */
        header, .controls, #bingo-container, .start-screen, #game-area {
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        #game-area {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: flex-start;
            max-width: 1100px;
            margin: 0 auto;
        }

        #bingo-container {
            grid-column: 2;
        }

        .score-display {
            grid-column: 3;
            justify-self: start;
        }

        h1 {
            font-family: 'VT323', monospace;
            font-size: 3rem;
            margin: 0 0 5px 0;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--warm-yellow) 0%, var(--sunset-pink) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 20px rgba(251, 191, 36, 0.4));
        }

        .subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* Media Player Style Controls */
        .controls {
            margin-bottom: 25px;
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 700px;
            flex-wrap: wrap;
        }

        .lang-switcher {
            padding: 10px 16px;
            font-size: 0.9rem;
            max-width: 100px;
            gap: 6px;
            flex-shrink: 0;
        }

        .lang-flag {
            font-size: 1.2rem;
        }

        .lang-text {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .score-display {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(244, 114, 182, 0.1));
            border: 3px solid var(--warm-yellow);
            padding: 20px 30px;
            border-radius: 24px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            box-shadow: 0 8px 30px rgba(251, 191, 36, 0.5),
                        inset 0 2px 0 rgba(255, 255, 255, 0.3);
            flex-shrink: 0;
            min-width: 140px;
        }

        .score-label {
            font-family: 'Quicksand', sans-serif;
            font-size: 1rem;
            color: var(--warm-yellow);
            font-weight: 600;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.8);
            letter-spacing: 1px;
        }

        .score-value {
            font-family: 'VT323', monospace;
            font-size: 3.5rem;
            color: var(--warm-yellow);
            font-weight: 400;
            line-height: 1;
            text-shadow: 0 0 30px rgba(251, 191, 36, 1),
                         0 0 60px rgba(251, 191, 36, 0.6);
        }

        button {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
            color: var(--text-color);
            padding: 14px 28px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            flex: 1;
            max-width: 180px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-icon {
            font-size: 1.5rem;
            line-height: 1;
            display: inline-block;
        }

        .btn-text {
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        button:hover {
            background: rgba(244, 114, 182, 0.15);
            border-color: var(--sunset-pink);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 114, 182, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        button:active {
            transform: translateY(0) scale(0.98);
        }

        button:focus-visible {
            outline: 2px solid var(--sunset-pink);
            outline-offset: 2px;
        }

        #restart-btn:hover .btn-icon {
            animation: spin 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #screenshot-btn:hover .btn-icon {
            animation: bounce-up 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes bounce-up {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        /* Retro Media Player Container */
        #bingo-container {
            padding: 20px;
            background: linear-gradient(145deg, rgba(42, 39, 56, 0.6), rgba(30, 28, 42, 0.8));
            border: 2px solid rgba(255, 255, 255, 0.12);
            border-radius: 24px;
            width: 100%;
            max-width: 550px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            width: 100%;
        }

        /* Retro Bingo Cards with Sticky Note Vibe */
        .card {
            aspect-ratio: 1;
            background: var(--card-bg);
            border: 1.5px solid var(--card-border);
            border-radius: 16px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.88rem;
            line-height: 1.35;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            position: relative;
            overflow: hidden;
            word-break: break-word;
            hyphens: auto;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.06);
        }

        .card:hover {
            background: var(--card-hover);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 24px rgba(244, 114, 182, 0.25),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border-color: rgba(244, 114, 182, 0.4);
        }

        /* Selected Card - "Lit Up" Sticky Note Effect */
        .card.selected {
            background: var(--card-selected);
            border: 2px solid var(--warm-yellow);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.5),
                        inset 0 0 20px rgba(251, 191, 36, 0.15),
                        0 8px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px);
        }

        /* Diagonal Strikethrough Line */
        .card.selected::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -5%;
            right: -5%;
            height: 3px;
            background: linear-gradient(90deg,
                transparent 0%,
                var(--warm-yellow) 15%,
                var(--sunset-pink) 50%,
                var(--warm-yellow) 85%,
                transparent 100%
            );
            transform: translateY(-50%) rotate(-12deg);
            box-shadow: 0 0 12px rgba(251, 191, 36, 0.8),
                        0 0 25px rgba(251, 191, 36, 0.4);
            pointer-events: none;
        }

        .card.selected::after {
            content: '‚úì';
            position: absolute;
            bottom: 6px;
            right: 8px;
            font-size: 1.4rem;
            color: var(--warm-yellow);
            font-weight: bold;
            text-shadow: 0 0 15px rgba(251, 191, 36, 1),
                         0 2px 5px rgba(0, 0, 0, 0.8);
            z-index: 1;
        }

        /* Win State - Relaxing Neon Pulse */
        .card.bingo-line {
            background: rgba(45, 212, 191, 0.3);
            border: 3px solid var(--win-color);
            box-shadow: 0 0 35px var(--win-glow),
                        inset 0 0 25px rgba(45, 212, 191, 0.2),
                        0 8px 24px rgba(0, 0, 0, 0.4);
            animation: neonPulse 1.5s ease-in-out infinite;
        }

        .card.bingo-line::before {
            background: linear-gradient(90deg,
                transparent 0%,
                var(--retro-teal) 15%,
                #2dd4bf 50%,
                var(--retro-teal) 85%,
                transparent 100%
            ) !important;
            box-shadow: 0 0 18px rgba(45, 212, 191, 1),
                        0 0 30px var(--win-glow) !important;
        }

        .card.bingo-line::after {
            color: #d1fae5 !important;
            font-size: 1.5rem !important;
            text-shadow: 0 0 20px rgba(45, 212, 191, 1),
                         0 2px 6px rgba(0, 0, 0, 0.9) !important;
        }

        @keyframes neonPulse {
            0%, 100% {
                box-shadow: 0 0 35px var(--win-glow),
                            inset 0 0 25px rgba(45, 212, 191, 0.2),
                            0 8px 24px rgba(0, 0, 0, 0.4);
            }
            50% {
                box-shadow: 0 0 50px rgba(45, 212, 191, 0.9),
                            inset 0 0 35px rgba(45, 212, 191, 0.35),
                            0 12px 32px rgba(0, 0, 0, 0.5);
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--sunset-pink), var(--purple-glow));
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 8px 24px rgba(244, 114, 182, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
            z-index: 10000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Footer */
        footer {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Quicksand', sans-serif;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.35);
            z-index: 1001;
            letter-spacing: 0.5px;
        }

        footer a {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            transition: color 0.25s ease;
        }

        footer a:hover {
            color: var(--sunset-pink);
        }

        /* Start Screen */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 35px;
            transition: opacity 0.5s ease;
        }

        .start-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .lang-switcher-start {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .start-screen h2 {
            font-family: 'VT323', monospace;
            font-size: 4rem;
            margin: 0;
            letter-spacing: 3px;
            background: linear-gradient(135deg, var(--warm-yellow) 0%, var(--sunset-pink) 50%, var(--purple-glow) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 40px rgba(251, 191, 36, 0.6));
            animation: glowPulse 3s ease-in-out infinite;
        }

        .start-screen p {
            font-size: 1.05rem;
            color: var(--text-secondary);
            max-width: 450px;
            text-align: center;
            line-height: 1.7;
            padding: 0 20px;
        }

        #start-btn {
            font-size: 1.1rem;
            padding: 16px 48px;
            background: linear-gradient(135deg, var(--sunset-pink), var(--purple-glow));
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(244, 114, 182, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
            max-width: none;
            flex: 0 0 auto;
        }

        #start-btn:hover {
            background: linear-gradient(135deg, var(--purple-glow), var(--sunset-pink));
            box-shadow: 0 12px 40px rgba(244, 114, 182, 0.6),
                        inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        @keyframes glowPulse {
            0%, 100% { filter: drop-shadow(0 0 40px rgba(251, 191, 36, 0.6)); }
            50% { filter: drop-shadow(0 0 60px rgba(251, 191, 36, 0.9)); }
        }

        body.not-started .controls,
        body.not-started #game-area {
            opacity: 0;
            pointer-events: none;
        }

        /* Mobile Adaptation */
        @media (max-width: 768px) {
            body { padding-top: 10px; }

            h1 { font-size: 2.5rem; }

            #game-area {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            #bingo-container {
                grid-column: 1;
                padding: 15px;
                max-width: 100%;
            }

            .score-display {
                grid-column: 1;
                justify-self: center;
                min-width: auto;
                width: 100%;
                max-width: 200px;
            }

            .card {
                font-size: 0.78rem;
                padding: 8px;
            }

            .card:hover {
                transform: none;
                background: var(--card-bg);
            }

            button:hover {
                transform: none;
            }

            .start-screen h2 { font-size: 3rem; }
            .start-screen p { font-size: 0.95rem; }
            #start-btn { font-size: 1rem; padding: 14px 40px; }

            .toast {
                top: auto;
                bottom: 20px;
                left: 20px;
                right: 20px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="not-started">

    <div class="ambient-glow" aria-hidden="true"></div>

    <!-- Background Audio -->
    <audio id="bg-audio" loop>
        <source src="lofi-bg.mp3" type="audio/mpeg">
    </audio>

    <!-- Start Screen -->
    <div class="start-screen" id="start-screen">
        <button id="lang-btn-start" aria-label="Switch language" class="lang-switcher lang-switcher-start">
            <span class="lang-flag">üá¨üáß</span>
            <span class="lang-text">EN</span>
        </button>
        <h2>BA BINGO</h2>
        <p id="start-description" data-lang-ru="–ò–≥—Ä–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ –∏ –≤—Å–µ—Ö, –∫—Ç–æ –≤ IT.<br>–û—Ç–º–µ—á–∞–π—Ç–µ –∑–Ω–∞–∫–æ–º—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ –ª–∏–Ω–∏–∏!" data-lang-en="A game for business analysts and everyone in IT.<br>Mark familiar situations and collect lines!">
            A game for business analysts and everyone in IT.<br>
            Mark familiar situations and collect lines!
        </p>
        <button id="start-btn" aria-label="Start game">
            <span data-lang-ru="‚ñ∂ –°—Ç–∞—Ä—Ç" data-lang-en="‚ñ∂ Start">‚ñ∂ Start</span>
        </button>
    </div>

    <header>
        <h1>BA BINGO</h1>
        <div class="subtitle">Relax, Collect Points, Share</div>
    </header>

    <div class="controls">
        <button id="lang-btn" aria-label="Switch language" class="lang-switcher">
            <span class="lang-flag">üá¨üáß</span>
            <span class="lang-text">EN</span>
        </button>
        <button id="restart-btn" aria-label="Restart game">
            <span class="btn-icon">‚Üª</span>
            <span class="btn-text" data-lang-ru="–†–µ—Å—Ç–∞—Ä—Ç" data-lang-en="Restart">Restart</span>
        </button>
        <button id="screenshot-btn" aria-label="Share">
            <span class="btn-icon">‚¨Ü</span>
            <span class="btn-text" data-lang-ru="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" data-lang-en="Share">Share</span>
        </button>
    </div>

    <div id="game-area">
        <div id="bingo-container">
            <div class="grid" id="grid" role="grid" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –±–∏–Ω–≥–æ"></div>
        </div>
        <div class="score-display">
            <span class="score-label" data-lang-ru="–û—á–∫–∏" data-lang-en="Score">Score</span>
            <span class="score-value" id="score">0</span>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Footer -->
    <footer>Created by Stepan S, 2025</footer>

    <noscript>
        <div style="text-align: center; margin-top: 20px; padding: 20px; background: rgba(255,0,0,0.1); border-radius: 12px; position: relative; z-index: 10;">
            <p>‚ö†Ô∏è –î–ª—è —Ä–∞–±–æ—Ç—ã –∏–≥—Ä—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å JavaScript</p>
        </div>
    </noscript>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js" defer></script>
    <script>
        const phrasesRU = [
            "–≠—Ç–æ –Ω–µ –±–∞–≥, —ç—Ç–æ —Ñ–∏—á–∞", "–£ –í–∏–≥–µ—Ä—Å–∞ —Ç–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ", "–¢–ó_final_v12.docx",
            "–°–¥–µ–ª–∞–π –∫—Ä–∞—Å–∏–≤–æ", "–°–∞–º –¥–æ–≥–∞–¥–∞–π—Å—è", "–ê –≤ —Å—Ç–æ—Ä–µ –Ω–µ —Ç–∞–∫",
            "–ú—ã –ø–µ—Ä–µ–¥—É–º–∞–ª–∏", "–ü–æ–∏–≥—Ä–∞—Ç—å —Å–æ —à—Ä–∏—Ñ—Ç–∞–º–∏", "–ö–Ω–æ–ø–∫–∞ '–°–¥–µ–ª–∞—Ç—å —Ö–æ—Ä–æ—à–æ'",
            "–ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ", "–ë—é–¥–∂–µ—Ç –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç", "–î–∞–≤–∞–π –≤ –±—ç–∫–ª–æ–≥",
            "–≠—Ç–æ –Ω–µ –≤ MVP", "–ù–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏", "–ö–∞–∫ —É Apple",
            "–£ –º–µ–Ω—è —Ä–∞–±–æ—Ç–∞–µ—Ç", "–ú–æ–∫–∞–π –¥–∞–Ω–Ω—ã–µ", "–≠—Ç–æ –ª–µ–≥–∞—Å–∏", "–î–∞–≤–∞–π —Ö–∞—Ä–¥–∫–æ–¥–æ–º",
            "–ë–∞–≥ –Ω–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è", "–°—Ç–µ–Ω–¥ —É–ø–∞–ª", "–ú–∏—Ç–∏–Ω–≥ –≤–º–µ—Å—Ç–æ –ø–∏—Å—å–º–∞",
            "UML –Ω–µ —Å–º–æ—Ç—Ä—è—Ç", "–ó–∞–±—ã–ª Confluence", "–°—Ä–æ–∫–∏ ‚Äî –≤—á–µ—Ä–∞",
            "–£—Ç–æ—á–Ω–µ–Ω–∏–µ –Ω–∞ —É—Ç–æ—á–Ω–µ–Ω–∏–µ", "–ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤ Git", "JSON –Ω–µ –≤–∞–ª–∏–¥–Ω—ã–π",
            "–°–æ–∑–≤–æ–Ω –Ω–∞ 5 –º–∏–Ω", "–Ø —Ç–∞–∫ –≤–∏–∂—É", "–ö–ª–∏–µ–Ω—Ç –Ω–µ –∑–Ω–∞–µ—Ç",
            "–ê–Ω–∞–ª–∏–∑ —Ä–∞–¥–∏ –∞–Ω–∞–ª–∏–∑–∞"
        ];

        const phrasesEN = [
            "It's not a bug, it's a feature", "BABOK says so", "requirements_final_v12.docx",
            "Make it pretty", "You figure it out", "Not like in prod",
            "We changed our mind", "Play with fonts", "Add 'Make it good' button",
            "Just add a field", "Budget exists, but no", "Let's backlog it",
            "Not in MVP", "Not documented", "Like Apple does",
            "Works on my machine", "Mock the data", "It's legacy", "Let's hardcode it",
            "Bug in requirements", "Test env is down", "Meeting instead of email",
            "Nobody reads UML", "Forgot Confluence", "Deadline was yesterday",
            "Clarification on clarification", "Git conflict", "Invalid JSON",
            "5-minute call", "I see it this way", "Client doesn't know",
            "Analysis for analysis sake"
        ];

        const gridSize = 4;
        let boardState = [];
        let currentLang = 'en';
        let score = 0;
        let completedLines = new Set(); // Track which lines have been completed

        // Fisher-Yates shuffle
        function shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function getCurrentPhrases() {
            return currentLang === 'ru' ? phrasesRU : phrasesEN;
        }

        function updateLanguage(lang) {
            currentLang = lang;

            // Update both language buttons
            [document.getElementById('lang-btn'), document.getElementById('lang-btn-start')].forEach(langBtn => {
                if (!langBtn) return;
                const langFlag = langBtn.querySelector('.lang-flag');
                const langText = langBtn.querySelector('.lang-text');

                if (lang === 'ru') {
                    langFlag.textContent = 'üá∑üá∫';
                    langText.textContent = 'RU';
                } else {
                    langFlag.textContent = 'üá¨üáß';
                    langText.textContent = 'EN';
                }
            });

            // Update all translatable elements
            document.querySelectorAll('[data-lang-ru]').forEach(el => {
                const text = el.getAttribute('data-lang-' + lang);
                if (el.id === 'start-description') {
                    el.innerHTML = text;
                } else {
                    el.textContent = text;
                }
            });
        }

        function generateBoard() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            boardState = [];
            score = 0;
            completedLines = new Set();
            updateScore();
            const shuffledPhrases = shuffle(getCurrentPhrases()).slice(0, gridSize * gridSize);

            shuffledPhrases.forEach((text, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = text;
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                card.setAttribute('aria-pressed', 'false');
                card.setAttribute('aria-label', text);

                card.addEventListener('click', () => toggleCard(card, index));
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleCard(card, index);
                    }
                });

                grid.appendChild(card);
                boardState.push({ selected: false, el: card });
            });
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
        }

        function toggleCard(card, index) {
            const state = boardState[index];
            if (state.selected) return; // Prevent deselecting

            state.selected = true;
            card.classList.add('selected');
            card.setAttribute('aria-pressed', 'true');
            score += 10;
            updateScore();
            checkWin();
        }

        function checkWin() {
            const size = gridSize;
            let winningIndices = new Set();
            let newCompletedLines = [];

            // Rows
            for (let i = 0; i < size; i++) {
                if (boardState.slice(i * size, (i + 1) * size).every(c => c.selected)) {
                    for (let k = 0; k < size; k++) winningIndices.add(i * size + k);
                    const lineId = `row-${i}`;
                    if (!completedLines.has(lineId)) {
                        newCompletedLines.push(lineId);
                    }
                }
            }

            // Columns
            for (let i = 0; i < size; i++) {
                let colIndices = Array.from({length: size}, (_, j) => i + j * size);
                if (colIndices.every(idx => boardState[idx].selected)) {
                    colIndices.forEach(idx => winningIndices.add(idx));
                    const lineId = `col-${i}`;
                    if (!completedLines.has(lineId)) {
                        newCompletedLines.push(lineId);
                    }
                }
            }

            // Diagonals
            let d1 = Array.from({length: size}, (_, i) => i * (size + 1));
            let d2 = Array.from({length: size}, (_, i) => (i + 1) * (size - 1));
            if (d1.every(idx => boardState[idx].selected)) {
                d1.forEach(idx => winningIndices.add(idx));
                const lineId = 'diag-1';
                if (!completedLines.has(lineId)) {
                    newCompletedLines.push(lineId);
                }
            }
            if (d2.every(idx => boardState[idx].selected)) {
                d2.forEach(idx => winningIndices.add(idx));
                const lineId = 'diag-2';
                if (!completedLines.has(lineId)) {
                    newCompletedLines.push(lineId);
                }
            }

            // Award bonus points for new lines
            // Bonus increases with each line: 50, 100, 150, 200, etc.
            newCompletedLines.forEach(lineId => {
                completedLines.add(lineId);
                const lineCount = completedLines.size;
                const bonus = lineCount * 50;
                score += bonus;

                // Show bonus notification
                const bonusMsg = currentLang === 'ru'
                    ? `üéâ –õ–∏–Ω–∏—è ${lineCount}! –ë–æ–Ω—É—Å +${bonus}`
                    : `üéâ Line ${lineCount}! Bonus +${bonus}`;
                showToast(bonusMsg);
            });

            updateScore();

            boardState.forEach((state, idx) => {
                state.el.classList.toggle('bingo-line', winningIndices.has(idx));
            });
        }

        // Screenshot with clipboard copy
        async function takeScreenshot() {
            const btn = document.getElementById('screenshot-btn');
            const btnIcon = btn.querySelector('.btn-icon');
            const btnText = btn.querySelector('.btn-text');
            const element = document.getElementById("bingo-container");

            try {
                btn.disabled = true;
                const originalText = btnText.textContent;
                btnIcon.textContent = '‚è≥';
                btnText.textContent = currentLang === 'ru' ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : 'Creating...';

                // Create temporary overlay with score and URL
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: absolute;
                    bottom: 15px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(30, 28, 42, 0.95);
                    padding: 12px 24px;
                    border-radius: 16px;
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    backdrop-filter: blur(10px);
                    font-family: 'Quicksand', sans-serif;
                    text-align: center;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
                    z-index: 1000;
                `;

                const scoreText = document.createElement('div');
                scoreText.style.cssText = `
                    font-size: 1.1rem;
                    color: #fbbf24;
                    font-weight: 600;
                    margin-bottom: 4px;
                    text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
                `;
                scoreText.textContent = `${currentLang === 'ru' ? '–û—á–∫–∏' : 'Score'}: ${score}`;

                const urlText = document.createElement('div');
                urlText.style.cssText = `
                    font-size: 0.85rem;
                    color: #f472b6;
                    font-weight: 500;
                    letter-spacing: 0.5px;
                `;
                urlText.textContent = 'ba-bingo.netlify.app';

                overlay.appendChild(scoreText);
                overlay.appendChild(urlText);
                element.style.position = 'relative';
                element.appendChild(overlay);

                const canvas = await html2canvas(element, {
                    backgroundColor: "#1e1c2a",
                    scale: 3,
                    logging: false,
                    useCORS: true
                });

                // Remove overlay
                element.removeChild(overlay);

                // Convert to blob
                canvas.toBlob(async (blob) => {
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({ 'image/png': blob })
                        ]);

                        showToast(currentLang === 'ru' ? 'üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!' : 'üì∏ Screenshot copied to clipboard!');
                    } catch (err) {
                        console.error('Clipboard copy failed:', err);
                        showToast(currentLang === 'ru' ? '‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.' : '‚ùå Copy failed. Try again.');
                    }
                }, 'image/png');

                btnIcon.textContent = '‚¨Ü';
                btnText.textContent = originalText;
                btn.disabled = false;

            } catch (error) {
                console.error('Screenshot failed:', error);
                showToast(currentLang === 'ru' ? '‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞' : '‚ùå Screenshot failed');
                btnIcon.textContent = '‚¨Ü';
                btnText.textContent = currentLang === 'ru' ? '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è' : 'Share';
                btn.disabled = false;
            }
        }

        // Toast Notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Start Game with Music
        function startGame() {
            const startScreen = document.getElementById('start-screen');
            const bgAudio = document.getElementById('bg-audio');

            // Start background music
            bgAudio.play().catch(err => console.log('Audio autoplay blocked:', err));

            // Hide start screen
            startScreen.classList.add('hidden');
            document.body.classList.remove('not-started');

            // Generate board
            setTimeout(() => {
                generateBoard();
            }, 500);
        }

        // Language switcher
        function switchLanguage() {
            const newLang = currentLang === 'ru' ? 'en' : 'ru';

            // If game is in progress, preserve state and translate cards
            if (boardState.length > 0) {
                const selectedIndices = boardState.map((state, idx) =>
                    state.selected ? idx : null
                ).filter(idx => idx !== null);

                updateLanguage(newLang);

                // Regenerate board with new language but keep selections
                const grid = document.getElementById('grid');
                grid.innerHTML = '';
                const oldBoardState = [...boardState];
                boardState = [];
                const shuffledPhrases = shuffle(getCurrentPhrases()).slice(0, gridSize * gridSize);

                shuffledPhrases.forEach((text, index) => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerText = text;
                    card.setAttribute('role', 'button');
                    card.setAttribute('tabindex', '0');
                    card.setAttribute('aria-pressed', 'false');
                    card.setAttribute('aria-label', text);

                    // Restore selection if it was selected before
                    if (selectedIndices.includes(index)) {
                        card.classList.add('selected');
                        card.setAttribute('aria-pressed', 'true');
                    }

                    card.addEventListener('click', () => toggleCard(card, index));
                    card.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            toggleCard(card, index);
                        }
                    });

                    grid.appendChild(card);
                    boardState.push({
                        selected: selectedIndices.includes(index),
                        el: card
                    });
                });

                // Recheck win state
                checkWin();
            } else {
                updateLanguage(newLang);
            }
        }

        // Event listeners
        document.getElementById('start-btn').addEventListener('click', startGame);
        document.getElementById('restart-btn').addEventListener('click', generateBoard);
        document.getElementById('screenshot-btn').addEventListener('click', takeScreenshot);
        document.getElementById('lang-btn').addEventListener('click', switchLanguage);
        document.getElementById('lang-btn-start').addEventListener('click', switchLanguage);
    </script>
</body>
</html>
