<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="BA Bingo: –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤. –û—Ç–º–µ—á–∞–π—Ç–µ —Ç–∏–ø–∏—á–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ –ë–∏–Ω–≥–æ!">
    <meta name="keywords" content="–±–∏–∑–Ω–µ—Å –∞–Ω–∞–ª–∏—Ç–∏–∫, –±–∏–Ω–≥–æ, –∏–≥—Ä–∞, IT, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="BA Bingo: Lofi Edition">
    <meta property="og:description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ —Å Lofi –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π">
    <meta property="og:image" content="https://raw.githubusercontent.com/StepSaz/ba-bingo-lofi/main/preview.png">

    <title>BA Bingo: Lofi Edition</title>

    <!-- Preconnect –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.youtube.com">

    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --text-color: #e2e8f0;
            --accent-color: #818cf8;
            --highlight-bg: rgba(129, 140, 248, 0.2);
            --highlight-border: #818cf8;
            --win-color: #34d399;
            --mobile-breakpoint: 768px;
        }

        /* Minimal CSS Reset */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        * {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Fira Code', monospace;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, var(--bg-color) 70%);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px 10px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Ambient Decoration */
        .ambient-glow {
            position: fixed;
            width: 100%;
            height: 50vh;
            background: radial-gradient(circle, rgba(129, 140, 248, 0.15) 0%, transparent 70%);
            top: -100px;
            z-index: -1;
            pointer-events: none;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 1.8rem;
            margin: 0 0 5px 0;
            text-shadow: 0 0 20px rgba(129, 140, 248, 0.3);
        }

        .subtitle {
            font-size: 0.8rem;
            opacity: 0.6;
        }

        /* Controls */
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            width: 100%;
        }

        button {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-color);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.85rem;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); /* Safari support */
            flex: 1;
            max-width: 160px;
            -webkit-tap-highlight-color: transparent;
        }

        /* Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ backdrop-filter */
        @supports not (backdrop-filter: blur(10px)) {
            button {
                background: rgba(255, 255, 255, 0.1);
            }
        }

        button:hover {
            background: rgba(129, 140, 248, 0.15);
            border-color: var(--accent-color);
            transform: translateY(-1px);
        }

        button:active {
            transform: scale(0.96);
        }

        button:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Grid System */
        #bingo-container {
            padding: 15px;
            background: var(--bg-color);
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            width: 100%;
        }

        .card {
            aspect-ratio: 1;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.85rem;
            line-height: 1.3;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            position: relative;
            overflow: hidden;
            word-break: break-word;
            hyphens: auto;
            -webkit-tap-highlight-color: transparent;
            transition: all 0.2s;
        }

        .card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.02);
        }

        .card:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        .card.selected {
            background: var(--highlight-bg);
            border-color: var(--highlight-border);
        }

        .card.selected::after {
            content: '‚úì';
            position: absolute;
            bottom: 4px;
            right: 6px;
            font-size: 1rem;
            color: var(--accent-color);
            font-weight: bold;
        }

        .card.bingo-line {
            background: rgba(52, 211, 153, 0.2);
            border-color: var(--win-color);
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* YouTube Widget - Desktop Only */
        .youtube-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 280px;
            height: 158px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            background: #000;
        }

        /* Loading state */
        .loading {
            pointer-events: none;
            opacity: 0.6;
        }

        .loading::after {
            content: '‚è≥';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
        }

        /* --- MOBILE ADAPTATION --- */
        @media (max-width: 768px) {
            .youtube-widget {
                display: none !important;
            }

            body {
                padding-top: 10px;
            }

            h1 {
                font-size: 1.5rem;
            }

            #bingo-container {
                padding: 10px;
            }

            .card {
                font-size: 0.75rem;
                padding: 6px;
            }

            /* –£–±–∏—Ä–∞–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
            .card:hover {
                transform: none;
                background: var(--card-bg);
            }

            button:hover {
                transform: none;
                background: var(--card-bg);
            }
        }

        /* Accessibility: prefers-reduced-motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Preview Modal */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .preview-modal.active {
            display: flex;
        }

        .preview-content {
            background: var(--bg-color);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .preview-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .preview-actions button {
            flex: 0 1 auto;
        }

        /* Start Screen */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
            transition: opacity 0.5s ease;
        }

        .start-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .start-screen h2 {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 0 0 30px rgba(129, 140, 248, 0.5);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .start-screen p {
            font-size: 1rem;
            opacity: 0.7;
            max-width: 400px;
            text-align: center;
            line-height: 1.6;
            padding: 0 20px;
        }

        #start-btn {
            font-size: 1rem;
            padding: 14px 36px;
            background: var(--accent-color);
            border: 2px solid var(--accent-color);
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(129, 140, 248, 0.3);
            max-width: none;
            flex: 0 0 auto; /* Prevent flex stretching */
        }

        #start-btn:hover {
            background: rgba(129, 140, 248, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(129, 140, 248, 0.5);
        }

        #start-btn:active {
            transform: scale(0.98);
        }

        @keyframes pulse-glow {
            0%, 100% { text-shadow: 0 0 30px rgba(129, 140, 248, 0.5); }
            50% { text-shadow: 0 0 50px rgba(129, 140, 248, 0.8); }
        }

        /* Hide game elements initially */
        body.not-started .controls,
        body.not-started #bingo-container {
            opacity: 0;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .start-screen h2 {
                font-size: 2rem;
            }

            .start-screen p {
                font-size: 0.9rem;
            }

            #start-btn {
                font-size: 0.95rem;
                padding: 12px 32px;
            }
        }
    </style>
</head>
<body class="not-started">

    <div class="ambient-glow" aria-hidden="true"></div>

    <!-- Start Screen -->
    <div class="start-screen" id="start-screen">
        <h2>BA BINGO</h2>
        <p>
            –ò–≥—Ä–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ –∏ –∫–æ–º–∞–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.<br>
            –û—Ç–º–µ—á–∞–π—Ç–µ –∑–Ω–∞–∫–æ–º—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ –ª–∏–Ω–∏–∏!
        </p>
        <button id="start-btn" aria-label="–ù–∞—á–∞—Ç—å –∏–≥—Ä—É">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
    </div>

    <header>
        <h1>BA BINGO</h1>
        <div class="subtitle">Relax & Requirements</div>
    </header>

    <div class="controls">
        <button id="restart-btn" aria-label="–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É">üîÑ –†–µ—Å—Ç–∞—Ä—Ç</button>
        <button id="screenshot-btn" aria-label="–°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç">üì∏ –°–∫—Ä–∏–Ω</button>
    </div>

    <div id="bingo-container">
        <div class="grid" id="grid" role="grid" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –±–∏–Ω–≥–æ"></div>
    </div>

    <div class="youtube-widget" aria-label="Lofi –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä">
        <iframe
            id="youtube-player"
            width="100%" height="100%"
            src=""
            title="Lofi Girl Radio - —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã"
            frameborder="0"
            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
        </iframe>
    </div>

    <!-- Preview Modal -->
    <div class="preview-modal" id="preview-modal" role="dialog" aria-labelledby="preview-title" aria-modal="true">
        <div class="preview-content">
            <h2 id="preview-title" style="text-align: center; margin: 0;">–ü—Ä–µ–≤—å—é —Å–∫—Ä–∏–Ω—à–æ—Ç–∞</h2>
            <img class="preview-image" id="preview-image" alt="–ü—Ä–µ–≤—å—é —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –±–∏–Ω–≥–æ">
            <div class="preview-actions">
                <button id="download-btn" aria-label="–°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç">üíæ –°–∫–∞—á–∞—Ç—å</button>
                <button id="close-preview-btn" aria-label="–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–µ–≤—å—é">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <noscript>
        <div style="text-align: center; margin-top: 20px; padding: 20px; background: rgba(255,0,0,0.1); border-radius: 8px;">
            <p>‚ö†Ô∏è –î–ª—è —Ä–∞–±–æ—Ç—ã –∏–≥—Ä—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å JavaScript</p>
        </div>
    </noscript>

    <script>
        const phrases = [
            "–≠—Ç–æ –Ω–µ –±–∞–≥, —ç—Ç–æ —Ñ–∏—á–∞", "–£ –í–∏–≥–µ—Ä—Å–∞ —Ç–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ", "–¢–ó_final_v12.docx",
            "–°–¥–µ–ª–∞–π –∫—Ä–∞—Å–∏–≤–æ", "–°–∞–º –¥–æ–≥–∞–¥–∞–π—Å—è", "–ê –≤ —Å—Ç–æ—Ä–µ –Ω–µ —Ç–∞–∫",
            "–ú—ã –ø–µ—Ä–µ–¥—É–º–∞–ª–∏", "–ü–æ–∏–≥—Ä–∞—Ç—å —Å–æ —à—Ä–∏—Ñ—Ç–∞–º–∏", "–ö–Ω–æ–ø–∫–∞ '–°–¥–µ–ª–∞—Ç—å —Ö–æ—Ä–æ—à–æ'",
            "–ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ", "–ë—é–¥–∂–µ—Ç –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç", "–î–∞–≤–∞–π –≤ –±—ç–∫–ª–æ–≥",
            "–≠—Ç–æ –Ω–µ –≤ MVP", "–ù–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏", "–ö–∞–∫ —É Apple",
            "–£ –º–µ–Ω—è —Ä–∞–±–æ—Ç–∞–µ—Ç", "–ú–æ–∫–∞–π –¥–∞–Ω–Ω—ã–µ", "–≠—Ç–æ –ª–µ–≥–∞—Å–∏", "–î–∞–≤–∞–π —Ö–∞—Ä–¥–∫–æ–¥–æ–º",
            "–ë–∞–≥ –Ω–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è", "–°—Ç–µ–Ω–¥ —É–ø–∞–ª", "–ú–∏—Ç–∏–Ω–≥ –≤–º–µ—Å—Ç–æ –ø–∏—Å—å–º–∞",
            "UML –Ω–µ —Å–º–æ—Ç—Ä—è—Ç", "–ó–∞–±—ã–ª Confluence", "–°—Ä–æ–∫–∏ ‚Äî –≤—á–µ—Ä–∞",
            "–£—Ç–æ—á–Ω–µ–Ω–∏–µ –Ω–∞ —É—Ç–æ—á–Ω–µ–Ω–∏–µ", "–ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤ Git", "JSON –Ω–µ –≤–∞–ª–∏–¥–Ω—ã–π",
            "–°–æ–∑–≤–æ–Ω –Ω–∞ 5 –º–∏–Ω", "–Ø —Ç–∞–∫ –≤–∏–∂—É", "–ö–ª–∏–µ–Ω—Ç –Ω–µ –∑–Ω–∞–µ—Ç",
            "–ê–Ω–∞–ª–∏–∑ —Ä–∞–¥–∏ –∞–Ω–∞–ª–∏–∑–∞"
        ];

        const gridSize = 4;
        let boardState = [];
        let html2canvasLoaded = false;

        // Fisher-Yates shuffle (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º)
        function shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function generateBoard() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            boardState = [];
            const shuffledPhrases = shuffle(phrases).slice(0, gridSize * gridSize);

            shuffledPhrases.forEach((text, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = text;
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                card.setAttribute('aria-pressed', 'false');
                card.setAttribute('aria-label', text);

                // –ö–ª–∏–∫ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
                card.addEventListener('click', () => toggleCard(card, index));
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleCard(card, index);
                    }
                });

                grid.appendChild(card);
                boardState.push({ selected: false, el: card });
            });
        }

        function toggleCard(card, index) {
            const state = boardState[index];
            state.selected = !state.selected;
            card.classList.toggle('selected');
            card.setAttribute('aria-pressed', state.selected ? 'true' : 'false');
            checkWin();
        }

        function checkWin() {
            const size = gridSize;
            let winningIndices = new Set();

            // –°—Ç—Ä–æ–∫–∏
            for (let i = 0; i < size; i++) {
                if (boardState.slice(i * size, (i + 1) * size).every(c => c.selected)) {
                    for (let k = 0; k < size; k++) winningIndices.add(i * size + k);
                }
            }

            // –ö–æ–ª–æ–Ω–∫–∏
            for (let i = 0; i < size; i++) {
                let colIndices = Array.from({length: size}, (_, j) => i + j * size);
                if (colIndices.every(idx => boardState[idx].selected)) {
                    colIndices.forEach(idx => winningIndices.add(idx));
                }
            }

            // –î–∏–∞–≥–æ–Ω–∞–ª–∏
            let d1 = Array.from({length: size}, (_, i) => i * (size + 1));
            let d2 = Array.from({length: size}, (_, i) => (i + 1) * (size - 1));
            if (d1.every(idx => boardState[idx].selected)) d1.forEach(idx => winningIndices.add(idx));
            if (d2.every(idx => boardState[idx].selected)) d2.forEach(idx => winningIndices.add(idx));

            boardState.forEach((state, idx) => {
                state.el.classList.toggle('bingo-line', winningIndices.has(idx));
            });

            // Announce win –¥–ª—è screen readers
            if (winningIndices.size > 0) {
                const announcement = document.createElement('div');
                announcement.setAttribute('role', 'status');
                announcement.setAttribute('aria-live', 'polite');
                announcement.style.position = 'absolute';
                announcement.style.left = '-10000px';
                announcement.textContent = '–ë–∏–Ω–≥–æ! –í—ã–∏–≥—Ä—ã—à–Ω–∞—è –ª–∏–Ω–∏—è —Å–æ–±—Ä–∞–Ω–∞!';
                document.body.appendChild(announcement);
                setTimeout(() => announcement.remove(), 1000);
            }
        }

        // Lazy load html2canvas
        function loadHtml2Canvas() {
            return new Promise((resolve, reject) => {
                if (html2canvasLoaded) {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
                script.onload = () => {
                    html2canvasLoaded = true;
                    resolve();
                };
                script.onerror = () => reject(new Error('Failed to load html2canvas'));
                document.head.appendChild(script);
            });
        }

        let currentScreenshotDataUrl = null;

        async function takeScreenshot() {
            const btn = document.getElementById('screenshot-btn');
            const element = document.getElementById("bingo-container");

            try {
                btn.disabled = true;
                btn.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';

                await loadHtml2Canvas();

                btn.textContent = 'üì∏ –°–æ–∑–¥–∞–Ω–∏–µ...';

                const canvas = await html2canvas(element, {
                    backgroundColor: "#0f172a",
                    scale: 3,
                    logging: false,
                    useCORS: true
                });

                currentScreenshotDataUrl = canvas.toDataURL('image/png');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                const modal = document.getElementById('preview-modal');
                const previewImg = document.getElementById('preview-image');
                previewImg.src = currentScreenshotDataUrl;
                modal.classList.add('active');
                document.body.style.overflow = 'hidden'; // –û—Ç–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª

                btn.textContent = 'üì∏ –°–∫—Ä–∏–Ω';
                btn.disabled = false;

            } catch (error) {
                console.error('Screenshot failed:', error);
                btn.textContent = '‚ùå –û—à–∏–±–∫–∞';
                setTimeout(() => {
                    btn.textContent = 'üì∏ –°–∫—Ä–∏–Ω';
                    btn.disabled = false;
                }, 2000);
            }
        }

        function downloadScreenshot() {
            if (!currentScreenshotDataUrl) return;

            const link = document.createElement('a');
            link.download = `ba-bingo-${Date.now()}.png`;
            link.href = currentScreenshotDataUrl;
            link.click();

            closePreview();
        }

        function closePreview() {
            const modal = document.getElementById('preview-modal');
            modal.classList.remove('active');
            document.body.style.overflow = ''; // –í–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª –æ–±—Ä–∞—Ç–Ω–æ
        }

        // Event listeners
        document.getElementById('restart-btn').addEventListener('click', generateBoard);
        document.getElementById('screenshot-btn').addEventListener('click', takeScreenshot);
        document.getElementById('download-btn').addEventListener('click', downloadScreenshot);
        document.getElementById('close-preview-btn').addEventListener('click', closePreview);

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        document.getElementById('preview-modal').addEventListener('click', (e) => {
            if (e.target.id === 'preview-modal') {
                closePreview();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closePreview();
            }
        });

        // Start Game Flow
        function startGame() {
            const startScreen = document.getElementById('start-screen');
            const youtubePlayer = document.getElementById('youtube-player');

            // Start music with autoplay
            youtubePlayer.src = 'https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&controls=1&rel=0&modestbranding=1&enablejsapi=1';

            // Hide start screen
            startScreen.classList.add('hidden');

            // Show game elements
            document.body.classList.remove('not-started');

            // Generate board after animation
            setTimeout(() => {
                generateBoard();
            }, 500);
        }

        // Start button listener
        document.getElementById('start-btn').addEventListener('click', startGame);

        // Note: Don't generate board on load anymore
        // generateBoard(); -- removed
    </script>
</body>
</html>
